{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GRAPH VISUALIZE BFS ALGORITHM</title>

<style>
#graphArea { overflow: hidden !important; }
.run-btn {
    margin-top: 18px; margin-bottom: 10px; padding: 14px 28px !important;
    font-size: 18px !important; border-radius: 12px !important;
    background: linear-gradient(135deg, #00f58a, #41ffd1);
    color: #000; font-weight: 600; box-shadow: 0 0 12px rgba(0,255,180,0.6); cursor: pointer;
}
.run-btn:hover { transform: scale(1.10); background: linear-gradient(135deg, #35ff9d, #7affde); box-shadow: 0 0 18px rgba(0,255,200,0.9); }
body {
    background-image: url("{% static 'graphs/images/purple_wave.png' %}");
    background-size: cover; background-position: 80px; background-attachment: fixed;
    font-family: 'Inter', sans-serif; color: #ffffff; margin: 0; padding: 0; overflow-x: hidden;
}
.container { width: 85%; margin: auto; padding-top: 0px !important; }
h1 {
    font-size: 52px; margin: 24px auto 32px; padding: 14px 80px; display: block; width: fit-content;
    text-transform: uppercase; letter-spacing: 3px; font-weight: 800;
    background: linear-gradient(120deg, #1f2b7a, #3f51b5, #00e5ff);
    border-radius: 999px; box-shadow: 0 0 22px rgba(0, 229, 255, 0.55);
    color: #ffffff; -webkit-text-fill-color: #faf7f7; text-shadow: 0 0 10px rgba(0,0,0,0.45);
}
h1::after { content: none; }
.tab-buttons { text-align: center; margin-bottom: 30px; }
.tab-btn {
    padding: 12px 26px; margin: 0 10px; border: none; border-radius: 10px;
    font-size: 17px; font-weight: 600; cursor: pointer; transition: .25s;
    background: rgba(255,255,255,0.2); color: #ffffff; backdrop-filter: blur(6px);
}
.tab-btn.active { background: linear-gradient(135deg, #00e28a, #3dffcb); color: black; transform: scale(1.06); }
.tab-btn:hover { transform: scale(1.06); }
.glass-box {
    background: rgba(255,255,255,0.08); padding: 25px; border-radius: 14px;
    backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.12);
    box-shadow: 0 8px 30px rgba(0,0,0,0.45); margin-bottom: 40px;
}
.neon-title {
    font-size: 20px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px;
    background: linear-gradient(90deg, #00fff0, #41ffd1, #ffe66d);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    text-shadow: 0 0 10px rgba(0,255,200,0.8), 0 0 18px rgba(0,200,255,0.7);
    position: relative; display: inline-block;
}
.neon-title::after {
    content: ""; position: absolute; left: 0; bottom: -6px;
    width: 100%; height: 2px; border-radius: 999px;
    background: linear-gradient(90deg, #00e28a, #41ffd1); box-shadow: 0 0 10px rgba(0,255,200,0.8);
}
input {
    width: 100%; padding: 14px; font-size: 17px; background: rgba(255,255,255,0.12);
    border: 1px solid rgba(180,150,255,0.45); border-radius: 12px;
    color: #e8ebff; outline: none; transition: .25s;
}
input:focus { border-color: #c9b2ff; background: rgba(255,255,255,0.18); box-shadow: 0 0 15px #cdb3ff; }
button {
    padding: 12px 24px; font-size: 17px; border: none; border-radius: 10px;
    background: linear-gradient(135deg, #00d277, #21ffba); color: #0c0c0c;
    cursor: pointer; font-weight: 600; transition: .25s;
}
button:hover { transform: scale(1.08); background: linear-gradient(135deg, #0aff8a, #5affcc); }
svg {
    width: auto; height: auto; min-width: 100%; min-height: 600px;
    overflow: visible !important; border-radius: 16px;
    background: rgba(0,0,0,0.20); border: 1px solid rgba(255,255,255,0.1);
}
.node { transition: none !important; }
.node:hover { filter: none !important; }
.highlight-node { fill: #f7d206 !important; filter: drop-shadow(0 0 15px #f7d206); }
.edge { stroke: #eaee0d; stroke-width: 4; }
.highlight-edge { stroke: #00e5ff !important; stroke-width: 7 !important; }
#pdfTextBox {
    white-space: pre-line; background: rgba(0,0,0,0.35); padding: 25px;
    border-radius: 14px; color: #e8eaff; backdrop-filter: blur(10px);
    font-size: 17px; line-height: 1.7; margin-top: 25px; box-shadow: inset 0 0 25px rgba(0,0,0,0.4);
}
.pdf-wrapper {
    background: rgba(255,255,255,0.06); border-radius: 18px; padding: 35px;
    border: 1px solid rgba(255,255,255,0.12); box-shadow: 0 8px 35px rgba(0,0,0,0.45);
    backdrop-filter: blur(14px); margin-top: 25px;
}
.pdf-header {
    font-size: 28px; font-weight: 700; margin-bottom: 25px; color: #dff3ff;
    display: flex; align-items: center; gap: 12px;
}
.pdf-header i { font-size: 30px; color: #79d7ff; filter: drop-shadow(0 0 6px #79d7ff); }
#infoPanel { font-size: 16px !important; line-height: 1.55 !important; color: #e9ecff !important; }
#infoPanel h3 { font-size: 18px !important; font-weight: 700; margin-bottom: 15px; }

.bipartite-btn {
    margin-top: 18px;
    margin-bottom: 10px;
    padding: 14px 28px !important;
    font-size: 18px !important;
    border-radius: 12px !important;

    background: linear-gradient(135deg, #f39c12, #ffb74d);
    color: #000;
    font-weight: 600;
    box-shadow: 0 0 12px rgba(243, 156, 18, 0.6);
    cursor: pointer;
    transition: .25s;
}
.bipartite-btn:hover {
    transform: scale(1.10);
    background: linear-gradient(135deg, #ffb74d, #f5d49f);
    box-shadow: 0 0 18px rgba(243, 156, 18, 0.9);
}
.home-btn { 
    position: absolute; 
    top: 20px; 
    left: 30px; 
    color: #41ffd1; 
    text-decoration: none; 
    border: 1px solid #41ffd1; 
    padding: 5px 15px; 
    border-radius: 5px; 
    background: rgba(0,0,0,0.5); 
}
</style>
</head>

<body>
<a href="/" class="home-btn">⬅ Trang Chủ</a>
<div class="container">
    <h1>GRAPH VISUALIZE BFS ALGORITHM</h1>
    <div class="tab-buttons">
        <button id="visualBtn" class="tab-btn active" onclick="showVisual()">Trực quan hoá</button>
        <button id="introBtn" class="tab-btn" onclick="showIntro()">Giới thiệu thuật toán</button>
    </div>

    <div id="visualPanel">
        <div class="glass-box" style="margin-top: 5px;">
            <h3 class="neon-title">GIỚI THIỆU VỀ BFS:</h3>
            <h3>
                <p><b></b>1. Nguyên lý: Duyệt đồ thị theo chiều rộng (Layer by Layer) dùng Hàng đợi (Queue).</p>
                <p><b></b>2. Chọn đỉnh bắt đầu, đưa vào Queue.</p>
                <p><b></b>3. Lấy đỉnh ra, xét các đỉnh kề chưa thăm và đưa vào Queue.</p>
            </h3>

            <h3 class="neon-title">CHỌN LOẠI ĐỒ THỊ</h3>
            <div style="margin: 20px 0; text-align:center;">
                <button id="btn-undirected" class="tab-btn active">Đồ thị vô hướng</button>
                <button id="btn-directed" class="tab-btn">Đồ thị có hướng</button>
            </div>
            <script>
            document.getElementById("btn-undirected").onclick = function () {
                window.setGraphType("undirected"); this.classList.add("active"); document.getElementById("btn-directed").classList.remove("active");
            };
            document.getElementById("btn-directed").onclick = function () {
                window.setGraphType("directed"); this.classList.add("active"); document.getElementById("btn-undirected").classList.remove("active");
            };
            </script>

            <p class="neon-title"><b>NHẬP CÁC ĐỈNH:</b> (VD: A,B,C,D,E)</p>
            <input id="nodes" placeholder="A,B,C,D,E">

            <p class="neon-title"><b>NHẬP CÁC CẠNH:</b> (VD: A-B, A-C, B-D, C-E)</p>
            <input id="edges" placeholder="A-B,A-C,B-D,C-E">

            <p class="neon-title" style="margin-top: 20px;"><b>NHẬP ĐỈNH BẮT ĐẦU:</b></p>
            <input id="startNode" placeholder="VD: A">

            <div style="margin-top: 20px; display:flex; gap:14px; flex-wrap:wrap; justify-content: center;">
                <button class="bipartite-btn" onclick="runBipartiteCheck()">
                   Kiểm tra Đồ thị Hai phía</button>
                <button class="run-btn" onclick="runBFS()">Chạy thuật toán BFS</button>
            </div>
        </div>

        <div class="glass-box" style="display: flex; gap: 25px; align-items: flex-start; justify-content: space-between; padding: 25px;">
            <div style="flex: 2.3; height: 1200px; padding: 0; overflow: auto; border-radius: 16px; background: rgba(0,0,0,0.20); border: 1px solid rgba(255,255,255,0.12);">
                <div style="width: 100%; display: flex; justify-content: center; align-items: center;">
                    <svg id="graphArea" style="width: 1800px; height: 1200px; overflow: visible !important;"></svg>
                </div>
            </div>
            <div id="infoPanel" style="flex: 1; padding: 22px; height: 1100px; overflow-y: auto; border-radius: 14px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); margin-top: 40px;">
                <h3 style="margin-bottom: 10px;">TRẠNG THÁI DUYỆT (LOG)</h3>
                <div id="infoContent">Vui lòng nhập dữ liệu và nhấn chạy...</div>
            </div>
        </div>
    </div>

    <div id="introPanel" style="display:none;">
        <div class="glass-box">
            <div class="pdf-wrapper">
                <div class="pdf-header"><i></i> Giới thiệu thuật toán BFS</div>
                <div id="pdfTextBox">Đang tải nội dung...</div>
            </div>
        </div>
    </div>
</div>

<script src="https://d3js.org/d3.v7.min.js"></script>

<script>
    window.graphType = "undirected";
    window.setGraphType = (t) => window.graphType = t;
    window.getGraphType = () => window.graphType;
</script>

<script src="{% static 'graphs/js/algorithms_d3/bfs_dfs/bfs_d3.js' %}"></script>

<script>
function showVisual() {
    document.getElementById("visualPanel").style.display = "block";
    document.getElementById("introPanel").style.display = "none";
    document.getElementById("visualBtn").classList.add("active");
    document.getElementById("introBtn").classList.remove("active");
}

function showIntro() {
    document.getElementById("visualPanel").style.display = "none";
    document.getElementById("introPanel").style.display = "block";
    document.getElementById("visualBtn").classList.remove("active");
    document.getElementById("introBtn").classList.add("active");

    loadBFSIntroStatic();
}

function loadBFSIntroStatic() {
    const introBox = document.getElementById("pdfTextBox");

    const introContentHTML = `
        <h3 style="color:#f7d206; margin-bottom:15px; font-weight:700;">I. GIỚI THIỆU VỀ THUẬT TOÁN BFS (DUYỆT THEO CHIỀU RỘNG)</h3>
        <hr style="border-color:rgba(255,255,255,0.2);">

        <p>BFS là thuật toán cơ bản được sử dụng để duyệt hoặc tìm kiếm trên các cấu trúc dữ liệu dạng cây hoặc đồ thị. Thuật toán này rất hiệu quả trong việc truy cập, tìm kiếm và đánh dấu tất cả các nút chính được tìm thấy một cách chính xác theo chiều rộng.</p>

        <h3 style="color:#00e5ff; margin-top: 25px; margin-bottom:10px; font-weight:700;">II. MỤC TIÊU CỦA THUẬT TOÁN</h3>

        <p>Mục tiêu chính của BFS bao gồm:</p>
        <ul style="margin-left:15px; line-height:1.8;">
            <li>Duyệt đồ thị có hệ thống: Thuật toán thăm tất cả các nút (đỉnh) có thể đến được từ nút nguồn theo thứ tự tăng dần khoảng cách.</li>
            <li>Tìm đường đi ngắn nhất: BFS luôn tìm ra đường đi ngắn nhất (tính theo số cạnh) giữa nút nguồn và bất kỳ nút đích nào khác trong đồ thị không trọng số.</li>
        </ul>

        <h3 style="color:#f7d206; margin-top: 25px; margin-bottom:10px; font-weight:700;">III. QUY TẮC HOẠT ĐỘNG CHI TIẾT</h3>

        <ol style="margin-left:15px; line-height:1.8;">
            <li>Cấu trúc dữ liệu chính được BFS sử dụng là Hàng đợi (Queue), hoạt động theo nguyên tắc FIFO (First in First Out).</li>
            <li>Thuật toán bắt đầu bằng cách đánh dấu một nút bất kỳ trong đồ thị là nút gốc và bắt đầu duyệt dữ liệu từ nút đó.</li>
            <li>BFS truy cập một nút chưa được truy cập liền kề với nút hiện tại, đánh dấu nút đó là đã hoàn thành và chèn nó vào hàng đợi.</li>
            <li>Khi không tìm thấy đỉnh liền kề nào chưa được thăm, đỉnh trước đó sẽ được loại bỏ khỏi hàng đợi.</li>
            <li>Quá trình này lặp lại cho đến khi tất cả các đỉnh trong biểu đồ được duyệt thành công và được đánh dấu là đã hoàn thành.</li>
            <li>Điều quan trọng là BFS đảm bảo không có vòng lặp nào được tạo ra trong quá trình truyền dữ liệu từ bất kỳ nút nào.</li>
        </ol>

        <hr style="border-color:rgba(255,255,255,0.2); margin-top:25px;">
        <p style="color:#aaa; font-size:14px; text-align:right;">()</p>
    `;

    introBox.innerHTML = introContentHTML;
}

</script>