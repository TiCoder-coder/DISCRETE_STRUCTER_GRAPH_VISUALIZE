{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KRUSKAL MINIMUM SPANNING TREE</title>

<style>
#graphArea { overflow: hidden !important; }

.run-btn {
    margin-top: 18px;
    margin-bottom: 10px;
    padding: 14px 28px !important;
    font-size: 18px !important;
    border-radius: 12px !important;
    background: linear-gradient(135deg, #00f58a, #41ffd1);
    color: #000;
    font-weight: 600;
    box-shadow: 0 0 12px rgba(0,255,180,0.6);
    cursor: pointer;
    transition: .25s;
}

.run-btn:hover {
    transform: scale(1.10);
    background: linear-gradient(135deg, #35ff9d, #7affde);
    box-shadow: 0 0 18px rgba(0,255,200,0.9);
}

body {
    background-image: url("{% static 'graphs/images/purple_wave.png' %}");
    background-size: cover;
    background-position: 80px;
    background-attachment: fixed;
    font-family: 'Inter', sans-serif;
    color: #ffffff;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
}

.container {
    width: 85%;
    margin: auto;
    padding-top: 0px !important;
}

h1 {
    font-size: 52px;
    margin: 24px auto 32px;
    padding: 14px 80px;
    display: block;
    width: fit-content;
    text-transform: uppercase;
    letter-spacing: 3px;
    font-weight: 800;
    background: linear-gradient(120deg, #1f2b7a, #3f51b5, #00e5ff);
    border-radius: 999px;
    box-shadow: 0 0 22px rgba(0, 229, 255, 0.55);
    color: #ffffff;
    -webkit-text-fill-color: #faf7f7;
    text-shadow: 0 0 10px rgba(0,0,0,0.45);
}

.tab-buttons {
    text-align: center;
    margin-bottom: 30px;
}

.tab-btn {
    padding: 12px 26px;
    margin: 0 10px;
    border: none;
    border-radius: 10px;
    font-size: 17px;
    font-weight: 600;
    cursor: pointer;
    transition: .25s;
    background: rgba(255,255,255,0.2);
    color: #ffffff;
    backdrop-filter: blur(6px);
}

.tab-btn.active {
    background: linear-gradient(135deg, #00e28a, #3dffcb);
    color: black;
    transform: scale(1.06);
}

.tab-btn:hover { transform: scale(1.06); }

.glass-box {
    background: linear-gradient(135deg, #1f2464, #2c257c, #4b2d8a);
    padding: 25px;
    border-radius: 22px;
    border: 2px solid rgba(0,255,255,0.35);
    box-shadow: 0 0 25px rgba(0,255,255,0.25);
}

.neon-title {
    font-size: 20px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 10px;
    background: linear-gradient(90deg, #00fff0, #41ffd1, #ffe66d);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 10px rgba(0,255,200,0.8), 0 0 18px rgba(0,200,255,0.7);
    display: inline-block;
    position: relative;
}

.neon-title::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: -6px;
    width: 100%;
    height: 2px;
    border-radius: 999px;
    background: linear-gradient(90deg, #00e28a, #41ffd1);
    box-shadow: 0 0 10px rgba(0,255,200,0.8);
}

input {
    width: 100%;
    padding: 14px;
    font-size: 17px;
    background: rgba(255,255,255,0.12);
    border: 1px solid rgba(180,150,255,0.45);
    border-radius: 12px;
    color: #e8ebff;
    outline: none;
    transition: .25s;
}

input:focus {
    border-color: #c9b2ff;
    background: rgba(255,255,255,0.18);
    box-shadow: 0 0 15px #cdb3ff;
}

svg {
    width: auto;
    height: auto;
    min-width: 100%;
    min-height: 600px;
    overflow: visible !important;
    border-radius: 16px;
    background: rgba(0,0,0,0.20);
    border: 1px solid rgba(255,255,255,0.1);
}

.node circle { transition: all 0.3s ease; }
.node:hover circle { filter: brightness(1.4) drop-shadow(0 0 12px #0ff); }

.highlight-node circle { fill: #f7d206 !important; filter: drop-shadow(0 0 20px #f7d206); }
.edge { stroke: #eaee0d; stroke-width: 4; }
.highlight-edge { stroke: #ff4704 !important; stroke-width: 3 !important; animation: pulse 1.5s infinite; }



#totalWeight {
    font-size: 26px;
    font-weight: bold;
    color: #00ffea;
    text-shadow: 0 0 15px #00ffea;
    margin-top: 15px;
}



.pdf-wrapper {
    background: linear-gradient(135deg, rgba(32, 43, 122, 0.75), rgba(94, 52, 182, 0.6));
    padding: 40px;
    border-radius: 22px;
    border: 2px solid rgba(0, 255, 255, 0.35);
    box-shadow: 0 0 22px rgba(0, 255, 255, 0.25);
    backdrop-filter: blur(12px);
}
.pdf-header {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 20px;
    color: #ffffff;
    text-shadow: 0 0 10px rgba(0,0,0,0.6);
}
.pdf-header i {
    font-size: 30px;
    color: #79d7ff;
    filter: drop-shadow(0 0 6px #79d7ff);
}

#pdfTextBox {
    background: rgba(0, 0, 0, 0.55); 
    padding: 28px;
    border-radius: 16px;
    font-size: 18px;
    line-height: 1.8;
    color: #e6e6e6;        
    border-left: 4px solid #3df5ff;
    box-shadow: inset 0 0 20px rgba(0,255,255,0.25);
    white-space: pre-wrap;
}
#pdfTextBox * {
    color: #e6e6e6 !important;     
    background: transparent !important;
}


.edge-highlight { stroke: #ffff00 !important; stroke-width: 7px !important; filter: drop-shadow(0 0 18px yellow); }
.edge-mst      { stroke: #00ff88 !important; stroke-width: 7px !important; filter: drop-shadow(0 0 22px #00ff88); }
.edge-rejected { stroke: #ff3366 !important; stroke-width: 3px; opacity: 0.35; }
.edge-candidate { stroke: #ffff88 !important; stroke-width: 7px; opacity: 0.7; }




</style>

</head>

<body>
<div class="container">

    <h1>KRUSKAL MINIMUM SPANNING TREE</h1>

    <div class="tab-buttons">
        <button id="visualBtn" class="tab-btn active" onclick="showVisual()">Trực quan hoá</button>
        <button id="introBtn" class="tab-btn" onclick="showIntro()">Giới thiệu thuật toán</button>
    </div>

    <!-- TAB TRỰC QUAN HOÁ -->
    <div id="visualPanel">

        <div class="glass-box">
            <h3 class="neon-title">NHẬP DANH SÁCH ĐỈNH</h3>
            <input id="nodes" placeholder="VD: A,B,C,D,E,F">

            <h3 class="neon-title">NHẬP CÁC CẠNH VÀ TRỌNG SỐ</h3>
            <input id="edges" placeholder="VD: A-B-4, A-C-8, B-D-8, C-D-2, C-E-7, D-E-6">

            <div style="text-align:center; margin-top:25px;">
                <button class="run-btn" onclick="runKruskal()">CHẠY KRUSKAL</button>
            </div>
        </div>

        <div class="glass-box" style="display:flex; gap:30px; align-items:flex-start;">
            <div style="flex:2.5;">
                <svg id="graphArea"></svg>
                <div style="text-align:center; margin-top:20px;">
                    <span style="font-size:24px;">Tổng trọng số MST:</span>
                    <span id="totalWeight" style="font-size:30px; color:#00ffea;">0</span>
                </div>
            </div>

            <div style="flex:1; background:rgba(255,255,255,0.08); padding:20px; border-radius:14px; height:600px; overflow-y:auto;">
                <h3 style="color:#79d7ff; margin-top:0;">QUÁ TRÌNH THỰC HIỆN</h3>
                <div id="infoContent" style="font-size:16px; line-height:1.7; color:#e0e7ff;">
                    Chưa chạy thuật toán...
                </div>
            </div>
        </div>
    </div>


   <!-- TAB GIỚI THIỆU -->
<div id="introPanel" style="display:none;">
    <div class="glass-box" 
         style="background: linear-gradient(135deg, rgba(32,43,122,0.75), rgba(94,52,182,0.6)); 
                padding: 40px; 
                border-radius: 22px;
                border: 2px solid rgba(0,255,255,0.35);
                box-shadow: 0 0 22px rgba(0,255,255,0.25);
                backdrop-filter: blur(12px);">

        <div class="pdf-wrapper" style="background: transparent; border: none; box-shadow: none; padding: 0;">
            
            <div class="pdf-header" 
                 style="font-size: 32px; 
                        font-weight: 700; 
                        margin-bottom: 22px; 
                        color: #ffffff;
                        text-shadow: 0 0 10px rgba(0,0,0,0.6);">
                Giới thiệu thuật toán Kruskal
            </div>

            <div id="pdfTextBox"
                 style= "
                    background:
                    rgba(0, 0, 0, 0.35);
                    backdrop-filter: blur(8px);
                    padding: 26px;
                    border-radius: 16px;
                    font-size: 18px;
                    line-height: 1.85;
                    color: #e8e8e8;
                    border-left: 4px solid #3df5ff;
                    box-shadow: inset 0 0 12px rgba(0, 255, 255, 0.22);
                ">
                Đang tải nội dung giới thiệu...
            </div>

        </div>
    </div>
</div>


</div>
</div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="{% static 'graphs/js/algorithms_d3/kruskal/kruskal.js' %}"></script>

<script>
// Tab chuyển đổi
function showVisual() {
    document.getElementById("visualPanel").style.display = "block";
    document.getElementById("introPanel").style.display = "none";
    document.getElementById("visualBtn").classList.add("active");
    document.getElementById("introBtn").classList.remove("active");
}

function showIntro() {
    document.getElementById("visualPanel").style.display = "none";
    document.getElementById("introPanel").style.display = "block";
    document.getElementById("visualBtn").classList.remove("active");
    document.getElementById("introBtn").classList.add("active");
    loadIntroText();
}


function runKruskal() {
    const nodesInput = document.getElementById("nodes").value.trim();
    const edgesInput = document.getElementById("edges").value.trim();

    if (!nodesInput || !edgesInput) {
        alert("Nhập đỉnh và cạnh đi nào anh ơi!");
        return;
    }

    const logBox = document.getElementById("infoContent");
    if (logBox) logBox.innerHTML = "<span style='color:#79d7ff'>Đang vẽ đồ thị... Đã xong!</span>";
    document.getElementById("totalWeight").textContent = "?";

    const nodes = nodesInput.split(",").map(s => s.trim()).filter(Boolean);
    const edges = edgesInput.split(",").map(s => {
        const p = s.trim().split("-");
        if (p.length < 2) return null;
        return {
            source: p[0].trim(),
            target: p[1].trim(),
            weight: p[2] ? parseInt(p[2]) : 1
        };
    }).filter(Boolean);

    initKruskalGraph();          
    drawKruskalGraph(nodes, edges);

    fetch("/api/graph/kruskal/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]")?.value || ""
        },
        body: JSON.stringify({
            nodes: nodes,
            edges: edgesInput
        })
    })
    .then(r => r.json())
    .then(data => {
        if (data.error || data.mst_cost === -1) {
            document.getElementById("stepLog").innerHTML = 
                "<span style='color:#ff4444; font-size:1.4em;'>ĐỒ THỊ KHÔNG LIÊN THÔNG HOẶC LỖI!</span>";
            return;
        }
        runKruskalFromBackend(data.steps, data.mst_edges, data.mst_cost);
        
        document.getElementById("totalWeight").textContent = data.mst_cost;
    })
    .catch(err => {
        console.error(err);
        document.getElementById("stepLog").innerHTML = "Backend lỗi, nhưng đồ thị vẫn vẽ rồi nha!";
    });
}


// Load nội dung giới thiệu từ PDF 
function loadIntroText() {
    fetch("/api/pdf-text/kruskal/") 
        .then(res => res.json())
        .then(data => {
            document.getElementById("pdfTextBox").innerHTML = data.html ? data.html : `<pre>${data.text}</pre>`;
        })
        .catch(() => {
            document.getElementById("pdfTextBox").innerHTML = "Lỗi tải nội dung giới thiệu!";
        });
}
</script>
</body>
</html>